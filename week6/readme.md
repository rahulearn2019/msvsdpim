# RTL2GDS of the Analog design using openROAD( invoked by openFASOC)

With the necessary input files - gds of analog blocks and their dummy verilog we can proceed with the openFASOC flow to generate the complete analog block GDS.    
A directory - avsd4bituc, is created in the generators directory of openfasoc

![Screenshot from 2023-03-21 21-58-23](https://user-images.githubusercontent.com/50217106/226677270-e1751ed4-8883-4d6b-a6fb-809adadde9a7.png)

The necessary sub-directories for avsd4bituc are created.

![Screenshot from 2023-03-21 03-45-24](https://user-images.githubusercontent.com/50217106/226679150-da9f3152-0875-4fb8-bbee-5d908d267302.png)

The dummy verilog files are placed in the src directory

### contents of the test.json file
Include the frequency parameter in test.json file, and min and max frequency values are given according to the min max frequency vlaues defined in parameters.py script by default. In my case in parameters.py, by default min_freq is 5Mhz and max frequency is 12 Mhz. I went with the same frequencies for the design. 
![Screenshot from 2023-03-22 01-06-07](https://user-images.githubusercontent.com/50217106/226722166-5de39b89-33fc-45f6-bc59-4cae4412db85.png)

These values can be edited in parameters.py file in tools folder
![Screenshot from 2023-03-22 00-57-14(1)](https://user-images.githubusercontent.com/50217106/226736571-98ceff51-cee0-4311-9301-94821063f290.jpg)

The same frequency values are fed in modelfile.csv file present in tools directory.

![Screenshot from 2023-03-22 01-06-28](https://user-images.githubusercontent.com/50217106/226722335-17e836b1-a2d0-4903-a950-d385f0229edd.png)

### modifications in toplevel makefile - edit the commands that will be used for different purposes - verilog generation, rtl2gds etc.
![Screenshot from 2023-03-21 03-45-33](https://user-images.githubusercontent.com/50217106/226678613-44fdf5ba-1ee5-41a2-8268-d09fc99f936d.png)

#### avsd4bituc-gen.py, parameters.py and parse_rpt.py files in tools directory are modified as per generator directory structure

### The LEF and GDS of the auxilliary cells are placed in avsd4bituc/blocks/sky130hd - lef and gds folders respectively
To create LEF and GDS
- Import <design_name>.python.gds generated by Klayout
- Manually place the labels at repective locations. The make number of the port is the serial number of ports present in pre-layout spice netlist.
label VDD
port make 1
- After placing the labels - ``` port makeall```
- Rename the cellname as the same you want to use in your OpenFASOC flow - ```cellname rename ADC_FLASH_0 onebitADC```
- Write GDS - ```gds write onebitADC.gds```
- write LEF - ```lef writeall```

### The config.mk file in design directory is modified -
1. DESIGN_NICKNAME is changed
2. DESIGN_NAME is changed
3. verilog file top-module name is changed
4. Additional GDS and LEF file names are changed
5. Custom connections are removed if any
6. Domain Instances are removed if any(since we do not need any additional voltage domain. Domain instances LIST will use a domain_instances.txt which should contain cells to be placed in that domain.
7. VD1 area is removed  represents the area that needs to be alloted to a smaller voltage domain)

---> Now a shell is opened in the avsd4bituc directory in generators and to generate verilog the corresponding code defined in top level makefile is used. In my case - "make sky130hd_auc_verilog"

![Screenshot from 2023-03-31 22-04-00](https://user-images.githubusercontent.com/50217106/229180452-ea9e3c96-57f2-494b-a7f7-9a5d1c967f1a.png)

To run the remaining steps - synthesis, placement, routing and finishing - we cd into flow directory and open a shell, then the following commands are used one by one -

```make synth```
![Screenshot from 2023-03-31 22-04-21](https://user-images.githubusercontent.com/50217106/229181137-ac6ecba6-3ce4-47aa-8467-acc02fd1043e.png)

```make floorplan```
![Screenshot from 2023-03-31 22-04-34](https://user-images.githubusercontent.com/50217106/229181225-b33eca80-c1dc-4b84-89ca-112a1d78d7b5.png)

```make gui_floorplan```
![Screenshot from 2023-03-31 22-04-58](https://user-images.githubusercontent.com/50217106/229181241-d6bd1db0-7449-46a1-9bc9-642689cca728.png)

```make place```

![Screenshot from 2023-03-31 22-01-01](https://user-images.githubusercontent.com/50217106/229186331-9519f640-2e87-4f05-93c4-81795fd40e0f.png)

![Screenshot from 2023-03-31 22-01-14](https://user-images.githubusercontent.com/50217106/229186364-98e58c76-9660-4bb9-b122-a19e8a5bfacb.png)

``` make gui_place```
Since the flow was placement of macros only, and there are no standard cells, floorplan and placement gui are same. It has been observed that floorplan stage uses the LEF while placement stage uses GDS. When origin co-ordinates in LEF and GDS are not matching, it leeds to displacement of cells in placement or floorplan stage.
![Screenshot from 2023-03-31 22-05-19](https://user-images.githubusercontent.com/50217106/229182180-8257f39e-6456-4e64-96a8-370c1863c41e.png)

```make route```
![Screenshot from 2023-03-31 22-00-08](https://user-images.githubusercontent.com/50217106/229186202-76fcd4d4-5646-450b-959d-a30c78d3b2f9.png)

![Screenshot from 2023-03-31 22-40-19](https://user-images.githubusercontent.com/50217106/229188630-ccb9a604-db5f-4412-b24d-d4a19d2ce907.png)

```make gui_route```

![Screenshot from 2023-03-31 22-05-47](https://user-images.githubusercontent.com/50217106/229182254-d3c42b31-0e48-4d19-a083-af7892edbd90.png)

```make finish```
![Screenshot from 2023-03-31 22-06-17](https://user-images.githubusercontent.com/50217106/229180168-9ef30443-ff05-4844-b66c-5ca4cfe24e83.png)
![Screenshot from 2023-03-31 22-06-11](https://user-images.githubusercontent.com/50217106/229180221-1da11235-1c82-469d-9b59-502b51adab3b.png)

The flow writes files genarated at individual steps in /avsd4bit-uc/flow/results

![Screenshot from 2023-03-31 22-06-37](https://user-images.githubusercontent.com/50217106/229180119-d6d6cc7d-e801-4c7c-89e8-9e8f9276e541.png)

## Final Layout viewed in KLAYOUT

![Screenshot from 2023-03-31 21-55-58](https://user-images.githubusercontent.com/50217106/229185031-87969e08-c276-4ee2-94fb-facd609ed103.png)


![Screenshot from 2023-03-31 22-39-02](https://user-images.githubusercontent.com/50217106/229185615-cda9b045-0a88-40f3-998d-4fb298552ad2.png)

To check if design is DRC clean, ```make clean_all``` in flow directory and come to the generators folder and as per your makefile, use the make command that does complete verilog generation, RTL-GDS and physical verification. In my case - make sky130_auc_full

![Screenshot from 2023-03-31 21-58-15](https://user-images.githubusercontent.com/50217106/229184959-5891ce57-e7be-405a-a290-1a5df15f5d26.png)






Design is DRC clean for
DIE_AREA =  0 0 100 100
CORE_AREA = 10 10 90 90



	


